(function(O,C){typeof exports=="object"&&typeof module<"u"?module.exports=C():typeof define=="function"&&define.amd?define(C):(O=typeof globalThis<"u"?globalThis:O||self,O.mktar=C())})(this,(function(){"use strict";class O{#e;constructor(i){this.#e=i}encode(i){const A=new TextEncoder().encode(this.#e);return i=="\0"?A:(this.#e=A,this)}octal(i){const A=Number.prototype.toString.call(this.#e,8);return i=="\0"?A:(this.#e=A,this)}pad(i,A){const h=String.prototype.padStart.call(this.#e,i-1,"0")+"\0";return A=="\0"?h:(this.#e=h,this)}}function C(y){return new O(y)}function V(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}var z,N;function G(){if(N)return z;N=1;const y=i=>i.call.bind(i);return z={FunctionPrototypeBind:y(Function.prototype.bind),StringPrototypeCharCodeAt:y(String.prototype.charCodeAt),StringPrototypeIndexOf:y(String.prototype.indexOf),StringPrototypeLastIndexOf:y(String.prototype.lastIndexOf),StringPrototypeReplace:y(String.prototype.replace),StringPrototypeSlice:y(String.prototype.slice),StringPrototypeToLowerCase:y(String.prototype.toLowerCase)},z}var j,q;function J(){if(q)return j;q=1;const y=/\b(?:Windows|Win64|Win32)\b/i,i={};return j={process:{get platform(){if(typeof process=="object"){const h=process?.platform;if(typeof h=="string")return h}if(typeof navigator<"u"){const h=navigator?.userAgent;if(typeof h=="string"&&y.test(h))return"win32"}return"linux"},get env(){if(typeof process=="object"){const h=process?.env;if(typeof h=="object"&&h!==null)return h}return i},cwd(){return typeof process=="object"&&typeof process?.cwd=="function"?process.cwd():this.platform==="win32"?"C:\\":"/"}}},j}var D,I;function X(){return I||(I=1,D={CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_DOT:46,CHAR_FORWARD_SLASH:47,CHAR_BACKWARD_SLASH:92,CHAR_COLON:58,CHAR_QUESTION_MARK:63}),D}var T,F;function Y(){return F||(F=1,T={validateString:(A,h)=>{if(typeof A!="string")throw new TypeError(`Expected a string for ${h}`)},validateObject:(A,h)=>{if(typeof A!="object"||A===null)throw new TypeError(`Expected an object for ${h}`)}}),T}var W,M;function ee(){if(M)return W;M=1;const{FunctionPrototypeBind:y,StringPrototypeCharCodeAt:i,StringPrototypeIndexOf:A,StringPrototypeLastIndexOf:h,StringPrototypeReplace:p,StringPrototypeSlice:d,StringPrototypeToLowerCase:E}=G(),{process:L}=J(),{CHAR_UPPERCASE_A:se,CHAR_LOWERCASE_A:le,CHAR_UPPERCASE_Z:oe,CHAR_LOWERCASE_Z:fe,CHAR_DOT:P,CHAR_FORWARD_SLASH:w,CHAR_BACKWARD_SLASH:v,CHAR_COLON:k,CHAR_QUESTION_MARK:ce}=X(),{validateObject:ue,validateString:S}=Y(),K=L.platform==="win32";function g(e){return e===w||e===v}function U(e){return e===w}function _(e){return e>=se&&e<=oe||e>=le&&e<=fe}function x(e,t,r,o){let l="",s=0,f=-1,n=0,c=0;for(let u=0;u<=e.length;++u){if(u<e.length)c=String.prototype.charCodeAt.call(e,u);else{if(o(c))break;c=w}if(o(c)){if(!(f===u-1||n===1))if(n===2){if(l.length<2||s!==2||i(l,l.length-1)!==P||i(l,l.length-2)!==P){if(l.length>2){const b=h(l,r);b===-1?(l="",s=0):(l=d(l,0,b),s=l.length-1-h(l,r)),f=u,n=0;continue}else if(l.length!==0){l="",s=0,f=u,n=0;continue}}t&&(l+=l.length>0?`${r}..`:"..",s=2)}else l.length>0?l+=`${r}${d(e,f+1,u)}`:l=d(e,f+1,u),s=u-f-1;f=u,n=0}else c===P&&n!==-1?++n:n=-1}return l}function ae(e){return e?`${e[0]==="."?"":"."}${e}`:""}function Z(e,t){ue(t,"pathObject");const r=t.dir||t.root,o=t.base||`${t.name||""}${ae(t.ext)}`;return r?r===t.root?`${r}${o}`:`${r}${e}${o}`:o}const $={resolve(...e){let t="",r="",o=!1;for(let l=e.length-1;l>=-1;l--){let s;if(l>=0){if(s=e[l],S(s,`paths[${l}]`),s.length===0)continue}else t.length===0?s=L.cwd():(s=L.env[`=${t}`]||L.cwd(),(s===void 0||E(d(s,0,2))!==E(t)&&i(s,2)===v)&&(s=`${t}\\`));const f=s.length;let n=0,c="",u=!1;const b=i(s,0);if(f===1)g(b)&&(n=1,u=!0);else if(g(b))if(u=!0,g(i(s,1))){let a=2,m=a;for(;a<f&&!g(i(s,a));)a++;if(a<f&&a!==m){const H=d(s,m,a);for(m=a;a<f&&g(i(s,a));)a++;if(a<f&&a!==m){for(m=a;a<f&&!g(i(s,a));)a++;(a===f||a!==m)&&(c=`\\\\${H}\\${d(s,m,a)}`,n=a)}}}else n=1;else _(b)&&i(s,1)===k&&(c=d(s,0,2),n=2,f>2&&g(i(s,2))&&(u=!0,n=3));if(c.length>0)if(t.length>0){if(E(c)!==E(t))continue}else t=c;if(o){if(t.length>0)break}else if(r=`${d(s,n)}\\${r}`,o=u,u&&t.length>0)break}return r=x(r,!o,"\\",g),o?`${t}\\${r}`:`${t}${r}`||"."},normalize(e){S(e,"path");const t=e.length;if(t===0)return".";let r=0,o,l=!1;const s=i(e,0);if(t===1)return U(s)?"\\":e;if(g(s))if(l=!0,g(i(e,1))){let n=2,c=n;for(;n<t&&!g(i(e,n));)n++;if(n<t&&n!==c){const u=d(e,c,n);for(c=n;n<t&&g(i(e,n));)n++;if(n<t&&n!==c){for(c=n;n<t&&!g(i(e,n));)n++;if(n===t)return`\\\\${u}\\${d(e,c)}\\`;n!==c&&(o=`\\\\${u}\\${d(e,c,n)}`,r=n)}}}else r=1;else _(s)&&i(e,1)===k&&(o=d(e,0,2),r=2,t>2&&g(i(e,2))&&(l=!0,r=3));let f=r<t?x(d(e,r),!l,"\\",g):"";return f.length===0&&!l&&(f="."),f.length>0&&g(i(e,t-1))&&(f+="\\"),o===void 0?l?`\\${f}`:f:l?`${o}\\${f}`:`${o}${f}`},isAbsolute(e){S(e,"path");const t=e.length;if(t===0)return!1;const r=i(e,0);return g(r)||t>2&&_(r)&&i(e,1)===k&&g(i(e,2))},join(...e){if(e.length===0)return".";let t,r;for(let s=0;s<e.length;++s){const f=e[s];S(f,"path"),f.length>0&&(t===void 0?t=r=f:t+=`\\${f}`)}if(t===void 0)return".";let o=!0,l=0;if(g(i(r,0))){++l;const s=r.length;s>1&&g(i(r,1))&&(++l,s>2&&(g(i(r,2))?++l:o=!1))}if(o){for(;l<t.length&&g(i(t,l));)l++;l>=2&&(t=`\\${d(t,l)}`)}return $.normalize(t)},relative(e,t){if(S(e,"from"),S(t,"to"),e===t)return"";const r=$.resolve(e),o=$.resolve(t);if(r===o||(e=E(r),t=E(o),e===t))return"";let l=0;for(;l<e.length&&i(e,l)===v;)l++;let s=e.length;for(;s-1>l&&i(e,s-1)===v;)s--;const f=s-l;let n=0;for(;n<t.length&&i(t,n)===v;)n++;let c=t.length;for(;c-1>n&&i(t,c-1)===v;)c--;const u=c-n,b=f<u?f:u;let a=-1,m=0;for(;m<b;m++){const Q=i(e,l+m);if(Q!==i(t,n+m))break;Q===v&&(a=m)}if(m!==b){if(a===-1)return o}else{if(u>b){if(i(t,n+m)===v)return d(o,n+m+1);if(m===2)return d(o,n+m)}f>b&&(i(e,l+m)===v?a=m:m===2&&(a=3)),a===-1&&(a=0)}let H="";for(m=l+a+1;m<=s;++m)(m===s||i(e,m)===v)&&(H+=H.length===0?"..":"\\..");return n+=a,H.length>0?`${H}${d(o,n,c)}`:(i(o,n)===v&&++n,d(o,n,c))},toNamespacedPath(e){if(typeof e!="string"||e.length===0)return e;const t=$.resolve(e);if(t.length<=2)return e;if(i(t,0)===v){if(i(t,1)===v){const r=i(t,2);if(r!==ce&&r!==P)return`\\\\?\\UNC\\${d(t,2)}`}}else if(_(i(t,0))&&i(t,1)===k&&i(t,2)===v)return`\\\\?\\${t}`;return e},dirname(e){S(e,"path");const t=e.length;if(t===0)return".";let r=-1,o=0;const l=i(e,0);if(t===1)return g(l)?e:".";if(g(l)){if(r=o=1,g(i(e,1))){let n=2,c=n;for(;n<t&&!g(i(e,n));)n++;if(n<t&&n!==c){for(c=n;n<t&&g(i(e,n));)n++;if(n<t&&n!==c){for(c=n;n<t&&!g(i(e,n));)n++;if(n===t)return e;n!==c&&(r=o=n+1)}}}}else _(l)&&i(e,1)===k&&(r=t>2&&g(i(e,2))?3:2,o=r);let s=-1,f=!0;for(let n=t-1;n>=o;--n)if(g(i(e,n))){if(!f){s=n;break}}else f=!1;if(s===-1){if(r===-1)return".";s=r}return d(e,0,s)},basename(e,t){t!==void 0&&S(t,"ext"),S(e,"path");let r=0,o=-1,l=!0;if(e.length>=2&&_(i(e,0))&&i(e,1)===k&&(r=2),t!==void 0&&t.length>0&&t.length<=e.length){if(t===e)return"";let s=t.length-1,f=-1;for(let n=e.length-1;n>=r;--n){const c=i(e,n);if(g(c)){if(!l){r=n+1;break}}else f===-1&&(l=!1,f=n+1),s>=0&&(c===i(t,s)?--s===-1&&(o=n):(s=-1,o=f))}return r===o?o=f:o===-1&&(o=e.length),d(e,r,o)}for(let s=e.length-1;s>=r;--s)if(g(i(e,s))){if(!l){r=s+1;break}}else o===-1&&(l=!1,o=s+1);return o===-1?"":d(e,r,o)},extname(e){S(e,"path");let t=0,r=-1,o=0,l=-1,s=!0,f=0;e.length>=2&&i(e,1)===k&&_(i(e,0))&&(t=o=2);for(let n=e.length-1;n>=t;--n){const c=i(e,n);if(g(c)){if(!s){o=n+1;break}continue}l===-1&&(s=!1,l=n+1),c===P?r===-1?r=n:f!==1&&(f=1):r!==-1&&(f=-1)}return r===-1||l===-1||f===0||f===1&&r===l-1&&r===o+1?"":d(e,r,l)},format:y(Z,null,"\\"),parse(e){S(e,"path");const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;const r=e.length;let o=0,l=i(e,0);if(r===1)return g(l)?(t.root=t.dir=e,t):(t.base=t.name=e,t);if(g(l)){if(o=1,g(i(e,1))){let a=2,m=a;for(;a<r&&!g(i(e,a));)a++;if(a<r&&a!==m){for(m=a;a<r&&g(i(e,a));)a++;if(a<r&&a!==m){for(m=a;a<r&&!g(i(e,a));)a++;a===r?o=a:a!==m&&(o=a+1)}}}}else if(_(l)&&i(e,1)===k){if(r<=2)return t.root=t.dir=e,t;if(o=2,g(i(e,2))){if(r===3)return t.root=t.dir=e,t;o=3}}o>0&&(t.root=d(e,0,o));let s=-1,f=o,n=-1,c=!0,u=e.length-1,b=0;for(;u>=o;--u){if(l=i(e,u),g(l)){if(!c){f=u+1;break}continue}n===-1&&(c=!1,n=u+1),l===P?s===-1?s=u:b!==1&&(b=1):s!==-1&&(b=-1)}return n!==-1&&(s===-1||b===0||b===1&&s===n-1&&s===f+1?t.base=t.name=d(e,f,n):(t.name=d(e,f,s),t.base=d(e,f,n),t.ext=d(e,s,n))),f>0&&f!==o?t.dir=d(e,0,f-1):t.dir=t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},de=(()=>{if(K){const e=/\\/g;return()=>{const t=p(L.cwd(),e,"/");return d(t,A(t,"/"))}}return()=>L.cwd()})(),R={resolve(...e){let t="",r=!1;for(let o=e.length-1;o>=-1&&!r;o--){const l=o>=0?e[o]:de();S(l,`paths[${o}]`),l.length!==0&&(t=`${l}/${t}`,r=i(l,0)===w)}return t=x(t,!r,"/",U),r?`/${t}`:t.length>0?t:"."},normalize(e){if(S(e,"path"),e.length===0)return".";const t=i(e,0)===w,r=i(e,e.length-1)===w;return e=x(e,!t,"/",U),e.length===0?t?"/":r?"./":".":(r&&(e+="/"),t?`/${e}`:e)},isAbsolute(e){return S(e,"path"),e.length>0&&i(e,0)===w},join(...e){if(e.length===0)return".";let t;for(let r=0;r<e.length;++r){const o=e[r];S(o,"path"),o.length>0&&(t===void 0?t=o:t+=`/${o}`)}return t===void 0?".":R.normalize(t)},relative(e,t){if(S(e,"from"),S(t,"to"),e===t||(e=R.resolve(e),t=R.resolve(t),e===t))return"";const r=1,o=e.length,l=o-r,s=1,f=t.length-s,n=l<f?l:f;let c=-1,u=0;for(;u<n;u++){const a=i(e,r+u);if(a!==i(t,s+u))break;a===w&&(c=u)}if(u===n)if(f>n){if(i(t,s+u)===w)return d(t,s+u+1);if(u===0)return d(t,s+u)}else l>n&&(i(e,r+u)===w?c=u:u===0&&(c=0));let b="";for(u=r+c+1;u<=o;++u)(u===o||i(e,u)===w)&&(b+=b.length===0?"..":"/..");return`${b}${d(t,s+c)}`},toNamespacedPath(e){return e},dirname(e){if(S(e,"path"),e.length===0)return".";const t=i(e,0)===w;let r=-1,o=!0;for(let l=e.length-1;l>=1;--l)if(i(e,l)===w){if(!o){r=l;break}}else o=!1;return r===-1?t?"/":".":t&&r===1?"//":d(e,0,r)},basename(e,t){t!==void 0&&S(t,"ext"),S(e,"path");let r=0,o=-1,l=!0;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t===e)return"";let s=t.length-1,f=-1;for(let n=e.length-1;n>=0;--n){const c=i(e,n);if(c===w){if(!l){r=n+1;break}}else f===-1&&(l=!1,f=n+1),s>=0&&(c===i(t,s)?--s===-1&&(o=n):(s=-1,o=f))}return r===o?o=f:o===-1&&(o=e.length),d(e,r,o)}for(let s=e.length-1;s>=0;--s)if(i(e,s)===w){if(!l){r=s+1;break}}else o===-1&&(l=!1,o=s+1);return o===-1?"":d(e,r,o)},extname(e){S(e,"path");let t=-1,r=0,o=-1,l=!0,s=0;for(let f=e.length-1;f>=0;--f){const n=i(e,f);if(n===w){if(!l){r=f+1;break}continue}o===-1&&(l=!1,o=f+1),n===P?t===-1?t=f:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||o===-1||s===0||s===1&&t===o-1&&t===r+1?"":d(e,t,o)},format:y(Z,null,"/"),parse(e){S(e,"path");const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;const r=i(e,0)===w;let o;r?(t.root="/",o=1):o=0;let l=-1,s=0,f=-1,n=!0,c=e.length-1,u=0;for(;c>=o;--c){const b=i(e,c);if(b===w){if(!n){s=c+1;break}continue}f===-1&&(n=!1,f=c+1),b===P?l===-1?l=c:u!==1&&(u=1):l!==-1&&(u=-1)}if(f!==-1){const b=s===0&&r?1:s;l===-1||u===0||u===1&&l===f-1&&l===s+1?t.base=t.name=d(e,b,f):(t.name=d(e,b,l),t.base=d(e,b,f),t.ext=d(e,l,f))}return s>0?t.dir=d(e,0,s-1):r&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};return R.win32=$.win32=$,R.posix=$.posix=R,$._makeLong=$.toNamespacedPath,R._makeLong=R.toNamespacedPath,W=K?$:R,W}var te=ee();const ie=V(te);class ne{buffer;positions;name;data;type;mode;uid;gid;size;mtime;typeflag;linkname;magic;version;uname;gname;devmajor;devminor;prefix;padding;checksum;constructor(i){this.buffer=new Uint8Array(512),this.positions={name:{startsAt:0,bytes:100},mode:{startsAt:100,bytes:8},uid:{startsAt:108,bytes:8},gid:{startsAt:116,bytes:8},size:{startsAt:124,bytes:12},mtime:{startsAt:136,bytes:12},checksum:{startsAt:148,bytes:8},typeflag:{startsAt:156,bytes:1},linkname:{startsAt:157,bytes:100},magic:{startsAt:257,bytes:6},version:{startsAt:263,bytes:2},uname:{startsAt:265,bytes:32},gname:{startsAt:297,bytes:2},devmajor:{startsAt:329,bytes:8},devminor:{startsAt:337,bytes:8},prefix:{startsAt:345,bytes:155},padding:{startsAt:500,bytes:12}},!i?.name&&this.#i("Can't process, plesae provide the header name");const{base:A,dir:h}=ie.parse(i.name);this.name=A,this.type=i.type||=i.name.endsWith("/")?"directory":"file",this.mode=i.mode||=this.type=="directory"?493:420,this.uid=i.uid||=0,this.gid=i.gid||=0,this.mtime=i.mtime||=Math.floor(Date.now()/1e3),this.typeflag=this.type==="directory"?"5":"0",this.linkname=i.linkname||="",this.magic=i.magic||="ustar",this.version=i.version||="00",this.uname=i.uname||="",this.gname=i.gname||="",this.devmajor=i.devmajor||=0,this.devminor=i.devminor||=0,this.prefix=h||"",this.padding=i.padding||="",this.checksum=0,this.type==="directory"?(this.data=new Uint8Array(0),this.size=0):(this.data=i.data instanceof Uint8Array?i.data:typeof i.data=="string"?C(i.data).encode("\0"):C("").encode("\0"),this.size=this.data.byteLength>0?this.data.byteLength:typeof i.size=="number"?i.size:0,this.data.byteLength>0&&typeof i.size=="number"&&console.warn("header size gets calculated automatically when data is present")),this.#e("name","string"),this.#e("mode","numric"),this.#e("uid","numric"),this.#e("gid","numric"),this.#e("size","numric"),this.#e("mtime","numric"),this.#e("typeflag","string"),this.buffer[this.positions.typeflag.startsAt]=C(this.typeflag).encode("\0")[0],this.#e("linkname","string"),this.#e("magic","string"),this.#e("version","string"),this.#e("uname","string"),this.#e("gname","string"),this.#e("devmajor","numric"),this.#e("devminor","numric"),this.#e("prefix","string"),this.#e("padding","string");const p=C(" ").encode("\0")[0];for(let d=0;d<this.buffer.length;d++)d>=this.positions.checksum.startsAt&&d<this.positions.checksum.startsAt+this.positions.checksum.bytes?this.checksum+=p:this.checksum+=this.buffer[d];return this.#e("checksum","numric"),this}#e(i,A){const h=this.positions[i];switch(A){case"string":{this.#t(C(this[i]).encode("\0"),h.bytes,h.startsAt);break}case"numric":{this.#t(C(this[i]).octal().pad(h.bytes).encode("\0"),h.bytes,h.startsAt);break}default:this.#i(`Unknown field type: ${A}`)}}#t(i,A,h){const p=Math.min(i.length,A-1);this.buffer.set(i.subarray(0,p),h),p<i.length&&(this.buffer[h+p]=0)}#i(i){throw new Error(i)}}function re(y,i){if(i?.stream||i?.gzip){const A=new ReadableStream({async pull(h){for await(const p of B(y))h.enqueue(p);h.close()}});return i?.gzip?A.pipeThrough(new CompressionStream("gzip")):A}return B(y)}async function*B(y){for(const i of y){yield new ne({name:i.webkitRelativePath||i.name,mtime:i.lastModified,size:i.size}).buffer;for await(const A of i.stream())yield A;yield new Uint8Array((512-i.size%512)%512)}yield new Uint8Array(1024)}return re}));
